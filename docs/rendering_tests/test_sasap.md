Salmon brood tables, also called run reconstructions, utilize annual estimates of the total run (commercial catch plus escapement), and samples of ages, to estimate the number of recruits per age class. These data are useful for salmon biologists to understand salmon productivity and salmon life histories. These data can come in a number of different formats, but generally follow the pattern of: rows for each brood year, and columns for the estimated number of fish in each age class. This dataset consists of reformatted and compiled sockeye salmon (*Oncorhynchus nerka*) brood tables from Alaska, British Columbia, and Washington. Although temporal coverage varies by stock, many of the brood tables were updated in 2016, and some have reconstructions dating back to 1922. These datasets were gathered as part of the [State of Alaskan Salmon and People project](https://alaskasalmonandpeople.org/). Source information for the datasets can be found in the SourceInfo.csv file. A description of the merging and quality assurance process can be found in the broodTableProcessing.html file. Productivity (R/S) should not be directly compared among the stocks because some escapement counts are indices. Age classes are given in European Notation, where the first number is the number of winters spent in freshwater before going to sea (1 winter in freshwater = age-1.X), and the second number is the number of winters spent at sea (3 winters at sea = age-X.3).


Salmon are a critically important natural resource in socioecological systems of Alaska, with integral roles in the cultures, economies, and ecosystems of the state. Observed declines in salmon populations and body size have led to growing concern about the sustainability and future of salmon production [@Ohlberger_et_al_2018; @Ricker_1981]. However, research and management of wild salmon is hampered by the fragmentation of data that could otherwise provide powerful insights into the biology and sustainability of Pacific salmon systems if they were integrated [@Hampton_et_al_2013; @Peterman_2004]. The reconciliation of these datasets is one goal of the [State of Alaska's Salmon and People project](https://alaskasalmonandpeople.org/) (SASAP). SASAP consists of several synthesis working groups that are focused on specific questions related to salmon biology and management. One of these working groups, "Interacting Effects of Ocean Climate and At-Sea Competition on Alaskan Salmon", is using long-term salmon monitoring data to predict potential future trends in Alaskan salmon stocks.

One way of assessing salmon stocks is through the estimation of brood tables, in which the number of recruits from each age class of returning salmon is calculated using age class samples and the total run size (commercial catch plus escapement). The brood table data can then be used for evaluating productivity and viability of a population and for refining management goals (e.g. @Nelson_et_al_2006). Brood tables estimated from monitoring data exist for several salmon stocks across the northeast Pacific. The SASAP Data Task Force, a team organized specifically for data recovery tasks for the SASAP project, extracted these tables from their original reports, reformatted them for consistency (e.g. in column names), and compiled them together in the open-source language R for process documentation and reproducibility.


The dataset presented here consists of reformatted and compiled brood tables from 48 stocks of sockeye salmon (*Oncorhynchus nerka*) across Alaska, British Columbia, and Washington. These datasets were gathered as part of the [State of Alaska's Salmon and People project](https://alaskasalmonandpeople.org/), a large collaborative project that seeks to inform salmon management in Alaska by synthesizing data from a wide variety of sources. Source information (i.e. individuals who provided data) for the original datasets can be found in the SourceInfo.csv file. Although this project focuses on Alaskan salmon management, stocks from British Columbia and Washington are included for examining sockeye salmon population trends more broadly. Regions vary in the number of stocks with data -- while some regions are represented by multiple stocks in the dataset, AYK (Arctic-Yukon-Kuskokwim), northern British Columbia, and Washington have data for only one stock (Figure 1).
                
![Figure 1](https://knb.ecoinformatics.org/knb/d1/mn/v2/object/urn:uuid:62731e0f-023c-4d93-b16c-1ce17c2d2a2e)  
Figure 1.
                
Temporal coverage varies somewhat by stock, ranging from 35 years of data for Goodnews River to 95 years of data for Black Lake and Chignik Lake (Figure 2).
                
![Figure 2](https://knb.ecoinformatics.org/knb/d1/mn/v2/object/urn:uuid:78cd5968-8707-4f96-95ea-3d56383cb1bb)   
Figure 2.
                
Geographic information beyond the stock name and latitude and longitude includes region, sub-region (e.g. Bristol Bay North within Bristol Bay), and ocean region (either Bering Sea or Gulf of Alaska), allowing for analysis of trends at multiple spatial scales. Age classes are given in European Notation, where the first number is the number of winters spent in freshwater before going to sea (1 winter in freshwater = age-1.X), and the second number is the number of winters spent at sea (3 winters at sea = age-X.3).


This dataset contains 6 files. **BroodTables.csv** is the data file containing compiled brood table data. **StockInfo.csv** contains location and source/acquisition information for each salmon stock, and **SourceInfo.csv** lists the source information (the contact person who provided access to the data). The file **broodTableProcessing.html** is the output produced by the R Markdown file **broodTableProcessing.Rmd**, and it presents the reformatting and quality assurance steps that were taken to produce the "BroodTables.csv" file from the original tables. There is also a metadata file, **broodTable_metadata.xml**, which defines all attributes (i.e., columns) found in the .csv files, as well as other metadata about the overall dataset. The metadata are written in the [Ecological Metadata Language](https://knb.ecoinformatics.org/#external//emlparser/docs/index.html) (EML).

#### Understanding the brood table
If you open BroodTables.csv, you will see 34 columns.
                
* The first three columns contain stock information: the numeric identifier given to a stock, the species (in this dataset *O. nerka* is the only species represented), and the name of the stock, which is typically the name of the water body in which it is found.  
* The next 6 columns contain location information at different levels of spatial organization (Ocean region, SASAP region, sub-region, etc.) which are defined in the metadata. The latitude and longitude typically represent the location where monitoring data were collected, but may represent the head of the water body if the exact monitoring location was unavailable.  
* The UseFlag column identifies any rows where we may not want to include the data in an analysis, either because of questions about quality or consistency of the estimation method, or because there was not enough data for age classes from that year.  
* BroodYear contains the brood year whose age classes are being estimated.  
* TotalEscapement contains the total escapement value (number of returning fish that were not harvested) for a particular brood year.  
* Age class columns: These columns are presented in European Notation, where the first number is the number of winters spent in freshwater before going to sea, and the second number is the number of winters spent at sea. For example, fish in the column R1.2 spent 1 winter in freshwater and 2 winters at sea.  
* TotalRecruits contains the total recruitment value (the sum of the age class values) for a particular brood year.  

#### Understanding the .Rmd
The file broodTableProcessing.Rmd is an R Markdown file that can be run in R [R Core @R]. It describes the data reformatting and quality assurance procedures used to create BroodTables.csv, with functional code chunks that complete these steps. The .Rmd renders an html document, broodTableProcessing.html.


Brood tables for 48 sockeye salmon stocks were extracted from written reports by Alaska Department of Fish and Game or from .xls files. All tables were examined to determine which columns needed to be consistent in order to compile them together. Reformatting then proceeded in R. Any unnecessary or redundant columns were dropped. All brood tables were assigned columns for stock ID, brood year, region, subregion, a use flag based on the QA process, total escapement, and age classes 0.1 through 4.5. If these columns were already present, they were given a new name for consistency if necessary. If they were absent, then they were generated during the process of compiling the tables together and filled with NAs. Stock ID and UseFlag columns were input manually for each table. When all tables were reformatted, they were compiled with the `bind_rows` function, ensuring that all columns were present. After compiling, we joined the data table with the stock info table (StockInfo.csv) to derive additional location information, dropping columns that were deemed unnecessary.

Quality assurance steps were also completed programmatically in R. We checked first for acceptable values: that years were numeric and within reasonable bounds with no NAs, that age class columns were integers greater than or equal to zero with no NAs, and that escapement values were numeric values greater than zero. Several calculated values for recruits in the age class columns were real numbers instead of integers, but the data were meant to be interpreted as integers (number of fish) so we rounded all age class values down to the nearest integer. We also checked the total escapement values, some of which had values of zero. Upon examining these values, we found that they did not represent true zeros but instead indicated that no data were available, so we replaced them with NAs. We flagged these rows with "0" in the UseFlag column, because they cannot be used to calculate recruits per spawner.

We systematically estimated some minor return age groups in order to include more years that could be analyzed. This procedure involved the most recent year for which an old age group has not yet returned. If the age-specific value to be filled in was greater than 10% of the total brood return, then that value remained NA. If age-specific abundance was NA and abundance was less than 10% of the total brood return in the previous 2 brood years, then the abundance for that age group was estimated using the mean of the age-specific values from the previous 2 brood years.
$$R_i = \frac{R_{i-1} + R_{i-2}}{2}$$

We began by calculating the total number of recruits across age classes for every row. Then we defined a function to complete the process described above. We then ran this function over the compiled brood table, and recalculated the total number of recruits based on the new, infilled age class columns.

Following the age class infilling procedure, we set the UseFlag value based on whether a row had complete age class estimation, i.e., all major age classes had real values and not NA. Major age classes were those age classes where the long term mean was greater than 1% of the total recruits for that population, i.e.:
$$\mu_R > {0.01 \times \mu_{TR}}$$

Any rows within major age classes that had NA values present were flagged with "0" in the UseFlag column.

Next, we made corrections to specific stocks. We corrected the 1980 escapement value for the Kvichak River stock based on estimates of a mortality event that occurred during extremely high water, and we flagged the pre-1965 years for Black Lake and Chignik Lake because no other stocks have data prior to that year. Coghill River had been flagged because it had only two years of data for a rare age class (1.4), but this is a minor age class so we removed the flag. We also removed the flags for Portage River and Seymour River because they too had some NA values in relatively small age classes.

